doctype html
html
  head
    title
    link(rel="stylesheet", href="../css/base.css")
    script(type="text/javascript", src="../js/socket.io.min.js")
    script(type="text/javascript", src="../js/qrcode.min.js")
  body
    canvas(id="qrcode")
    input(id="btn", type="button", value="开始游戏")
    script.
      var qrcodedraw = new QRCodeLib.QRCodeDraw();
      var qrcode = document.getElementById('qrcode');
      var ip = '#{ip}';
      var port = '#{port}';
      var game = ['http://', ip, ':', port, '/mobile'].join('');
      var socket;

      qrcodedraw.draw(qrcode, game, function(err, canvas){
        if(err){
          console.log(err.message);
        } else {
          socket = io.connect(['http://', ip, ':', port].join(''));
          socket.on('connection', function (data) {
            console.log('connected');
            socket.emit('screen');
          });
          socket.on('click', function(data){
            console.log(data.totalClick);
          })
        }
      });

      var btn = document.getElementById('btn');
      btn.addEventListener('click', function(e){
        e.stopPropagation();
        socket.emit('game start');
      }, false);